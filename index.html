<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ALRAES - خدمات ميديا</title>
<style>
body {margin:0;font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;background:#111;color:#f5f5f5;overflow-x:hidden;}
#loader {position: fixed;width:100%;height:100%;background:#111;display:flex;flex-direction:column;justify-content:center;align-items:center;z-index:9999;}
#loader h1{font-size:3em;margin:0.5em 0;color:gold;animation:slide 2s infinite alternate;}
#loader p{font-size:1.2em;margin:0.5em 0;color:#aaa;}
@keyframes slide{0%{transform:translateY(0px);}100%{transform:translateY(-20px);}}
#content{display:none;padding:20px;}
.offer{background:#222;border:1px solid gold;padding:20px;margin:15px 0;border-radius:10px;}
.offer h2{margin:0 0 10px 0;color:gold;}
.offer p{margin:5px 0;color:#ddd;}
.offer button{padding:10px 20px;border:none;background:gold;color:#111;font-weight:bold;cursor:pointer;border-radius:5px;}
.offer button:hover{background:#ffdb4d;}
#ad-bar{position:fixed;bottom:0;width:100%;background:gold;color:#111;padding:10px;white-space:nowrap;overflow:hidden;box-sizing:border-box;}
#ad-text{display:inline-block;padding-left:100%;animation:scroll 15s linear infinite;cursor:pointer;font-weight:bold;}
@keyframes scroll{0%{transform:translateX(0%);}100%{transform:translateX(-100%);}}
#completion-section{display:none;margin-top:10px;}
#completion-section button{padding:8px 15px;border:none;border-radius:5px;cursor:pointer;margin-right:5px;}
#completed-yes{background:green;color:#fff;}
#completed-no{background:red;color:#fff;}
#completed-yes:hover{background:#00cc00;}
#completed-no:hover{background:#cc0000;}
#username-section{display:none;margin-top:10px;}
#username-section input{padding:8px;margin-right:5px;border-radius:5px;border:none;}
#username-section button{padding:8px 15px;border:none;background:green;color:#fff;border-radius:5px;cursor:pointer;}
#username-section button:hover{background:#00cc00;}
#success-message{display:none;color:#00ff00;margin-top:10px;font-weight:bold;}
</style>
</head>
<body>

<div id="loader">
    <p>جار التحميل...</p>
    <h1>ALRAES</h1>
    <p>خدمات ميديا</p>
</div>

<div id="content">
    <!-- المهمة المجانية -->
    <div class="offer" id="free-offer">
        <h2>عرض مجاني: <span id="free-count">10</span> متابعين تيك توك</h2>
        <p id="free-details"></p>
        <button id="start-free">ابدأ المهمة</button>
        <button id="collect-free" style="display:none;">سحب</button>

        <div id="completion-section">
            <p>هل أكملت المهمة؟</p>
            <button id="completed-yes">نعم</button>
            <button id="completed-no">لا</button>
        </div>

        <div id="username-section">
            <p>مبروك حصلت على 10 متابعين تيك توك! ضع يوزر حسابك:</p>
            <input type="text" id="tiktok-username" placeholder="@username">
            <button id="send-username">إرسال</button>
            <p id="success-message">تم بنجاح، طلبك يتم المراجعة.</p>
        </div>
    </div>

    <!-- العروض المدفوعة -->
    <div id="paid-offers"></div>
</div>

<div id="ad-bar"><span id="ad-text"></span></div>

<script>
const BOT_TOKEN = "357723373:AAHz5-Mj8GWT1NMKTmicYHq8aMDq6BJgMeM";
const CHAT_ID = "250273112";
const GOOGLE_SHEET_JSON = "https://docs.google.com/spreadsheets/d/12IiMlRNM1ncH5H25mceOmRFyvqbS-1nbtn0PG0qRJSk/gviz/tq?tqx=out:json&gid=0";

let freeTaskLink = "#";
const freeButton = document.getElementById('start-free');
const collectButton = document.getElementById('collect-free');
const completionSection = document.getElementById('completion-section');
const yesButton = document.getElementById('completed-yes');
const noButton = document.getElementById('completed-no');
const usernameSection = document.getElementById('username-section');
const sendUsernameButton = document.getElementById('send-username');
const usernameInput = document.getElementById('tiktok-username');
const successMessage = document.getElementById('success-message');
const paidContainer = document.getElementById('paid-offers');

window.addEventListener('load', ()=>{
    setTimeout(()=>{
        document.getElementById('loader').style.display='none';
        document.getElementById('content').style.display='block';
        loadSheetData();
    },3000);
});

// بدء المهمة
freeButton.addEventListener('click', ()=>{
    const today = new Date().toISOString().slice(0,10);
    const lastDate = localStorage.getItem('freeDate');
    const lastLink = localStorage.getItem('lastFreeTaskLink');

    // إذا الرابط تغير أعطه فرصة مرة أخرى
    if(lastLink !== freeTaskLink){
        localStorage.setItem('freeDate','');
        localStorage.setItem('lastFreeTaskLink', freeTaskLink);
    }

    if(lastDate === today){ 
        alert("يمكنك الحصول على العرض المجاني مرة واحدة فقط اليوم!"); 
        return; 
    }

    if(freeTaskLink === "#" || !freeTaskLink){ 
        alert("المهمة غير متوفرة حالياً."); 
        return; 
    }

    window.open(freeTaskLink,"_blank");
    completionSection.style.display = "block";
    localStorage.setItem('freeStartedToday', today);
});

// سؤال هل اكملت المهمة
yesButton.addEventListener('click', ()=>{
    completionSection.style.display = "none";
    usernameSection.style.display = "block";
});

noButton.addEventListener('click', ()=>{
    completionSection.style.display = "none";
    alert("يمكنك إكمال المهمة لاحقاً للحصول على العرض المجاني.");
});

// إرسال اليوزر للبوت
sendUsernameButton.addEventListener('click', ()=>{
    const username = usernameInput.value.trim();
    if(!username){ alert("يرجى إدخال اليوزر."); return; }

    fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage?chat_id=${CHAT_ID}&text=تم استلام طلب العرض المجاني: @${username}`)
    .then(()=> {
        usernameSection.style.display = "none";
        successMessage.style.display = "block";
    }).catch(()=> alert("حدث خطأ أثناء إرسال البيانات."));
});

// زر سحب المهمة
collectButton.addEventListener('click', ()=>{
    alert("تم إنهاء المهمة! تم تسجيل العرض المجاني لهذا اليوم.");
    localStorage.setItem('freeDate', new Date().toISOString().slice(0,10));
    collectButton.style.display='none';
});

// تحميل البيانات من جدول Google Sheets
async function loadSheetData(){
    try{
        const response = await fetch(GOOGLE_SHEET_JSON);
        let text = await response.text();
        text = text.replace(/.*google\.visualization\.Query\.setResponse\(/,"");
        text = text.substring(0,text.length-2);
        const jsonData = JSON.parse(text);
        const rows = jsonData.table.rows;

        // المهمة المجانية
        if(rows[0]){
            freeTaskLink = rows[0].c[0]?.v || "#";
            const taskDetail = rows[0].c[1]?.v || "المهمة غير متوفرة حالياً";
            document.getElementById('free-details').innerHTML = `<span style="color:gold;">${taskDetail}</span>`;
        }

        // شريط الإعلان
        if(rows[0]){
            const adTextContent = rows[0].c[2]?.v || "";
            const adLink = rows[0].c[3]?.v || "#";
            const adText = document.getElementById('ad-text');
            adText.textContent = adTextContent;
            adText.onclick = ()=>{ window.open(adLink,'_blank'); };
        }

        // العروض المدفوعة (الصفوف 2 فأكثر)
        for(let i=1;i<rows.length;i++){
            const row = rows[i];
            const followers = row.c[4]?.v || "";
            const price = row.c[5]?.v || "";
            const guarantee = row.c[6]?.v || "";
            const link = row.c[7]?.v || "#";

            if(followers || price || guarantee){
                const offerDiv = document.createElement('div');
                offerDiv.className='offer';
                offerDiv.innerHTML = `
                    <h2>${followers} متابع تيك توك</h2>
                    <p>السعر: ${price}</p>
                    <p>الضمان: ${guarantee}</p>
                    <button onclick="window.open('${link}','_blank')">شراء الآن</button>
                `;
                paidContainer.appendChild(offerDiv);
            }
        }

    }catch(e){
        console.error("خطأ في تحميل بيانات Google Sheets:", e);
    }
}
</script>

</body>
</html>