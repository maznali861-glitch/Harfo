<!doctype html>
<html lang="ar">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>دليل الأطباء</title>
  <style>
    body {
      font-family: "Tajawal", sans-serif;
      direction: rtl;
      margin: 0;
      padding: 0;
      color: #fff;
      background: url('https://images.unsplash.com/photo-1544717305-2782549b5136?auto=format&fit=crop&w=1350&q=80') no-repeat center center fixed;
      background-size: cover;
      position: relative;
    }
    body::before {
      content: "";
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.6);
      backdrop-filter: blur(2px);
      z-index: 0;
    }
    .container {
      position: relative;
      z-index: 1;
      max-width: 800px;
      margin: auto;
      padding: 20px;
    }
    h1 {
      text-align: center;
      margin-bottom: 5px;
    }
    .subtitle {
      text-align: center;
      font-size: 14px;
      color: #ccc;
      margin-bottom: 15px;
    }
    .telegram {
      text-align: center;
      margin-bottom: 25px;
    }
    .telegram a {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      background: #229ED9;
      color: #fff;
      text-decoration: none;
      padding: 10px 18px;
      border-radius: 30px;
      font-weight: bold;
      transition: 0.3s;
    }
    .telegram a:hover {
      background: #007bb5;
    }
    .stats {
      display: flex;
      gap: 15px;
      margin-bottom: 20px;
    }
    .stat {
      flex: 1;
      background: rgba(255,255,255,0.1);
      border-radius: 12px;
      text-align: center;
      padding: 20px;
    }
    .stat h2 { margin: 0; font-size: 26px; }
    .ad-banner {
      background: rgba(255,255,255,0.15);
      border-radius: 10px;
      overflow: hidden;
      margin-bottom: 20px;
      height: 50px;
      display: flex;
      align-items: center;
    }
    .ad-text {
      display: inline-block;
      white-space: nowrap;
      padding-left: 100%;
      animation: scroll 15s linear infinite;
      font-weight: bold;
      font-size: 18px;
    }
    @keyframes scroll {
      from { transform: translateX(0); }
      to { transform: translateX(-100%); }
    }
    .list { display: flex; flex-direction: column; gap: 15px; }
    .card {
      background: rgba(255,255,255,0.15);
      border-radius: 12px;
      padding: 15px;
    }
    .name { font-size: 20px; color: #4dd0e1; font-weight: bold; }
    .meta { color: #ddd; margin-top: 5px; }
    .phone { margin-top: 10px; }
    .no-data { color: #aaa; font-style: italic; }
  </style>
</head>
<body>
  <div class="container">
    <h1>دليل الأطباء</h1>
    <div class="subtitle">يتم رفع المعلومات من مزود التطبيق فقط</div>

    <div class="telegram">
      <a href="https://t.me/tele060" target="_blank">
        <img src="https://cdn-icons-png.flaticon.com/512/2111/2111646.png" width="20" /> تواصل عبر التليجرام
      </a>
    </div>

    <div class="stats">
      <div class="stat">
        <div>النتائج المعروضة</div>
        <h2 id="count">0</h2>
      </div>
      <div class="stat">
        <div>عدد التخصصات</div>
        <h2 id="specialties">0</h2>
      </div>
    </div>

    <div id="ad" class="ad-banner" style="display:none;">
      <div id="ad-text" class="ad-text"></div>
    </div>

    <div id="list" class="list">جاري التحميل...</div>
  </div>

  <script>
    const SHEET_ID = "1ofPgH85C0KrVNT-U8OG6ThGry53xOSYy3GsFVtbIIRo";
    const SHEET_NAME = "Sheet1"; 
    const url = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&sheet=${encodeURIComponent(SHEET_NAME)}`;

    function parseGviz(text) {
      const start = text.indexOf('{');
      const end = text.lastIndexOf('}');
      return JSON.parse(text.slice(start, end + 1));
    }

    function rowsToObjects(table) {
      const cols = table.cols.map(c => (c.label || "").trim());
      return table.rows.map(r => {
        const obj = {};
        cols.forEach((c, i) => obj[c] = r.c[i] ? r.c[i].v : "");
        return obj;
      });
    }

    async function loadData() {
      const listEl = document.getElementById('list');
      const adEl = document.getElementById('ad');
      const adText = document.getElementById('ad-text');
      try {
        const resp = await fetch(url);
        const text = await resp.text();
        const parsed = parseGviz(text);
        const rows = rowsToObjects(parsed.table);

        if (rows.length === 0) {
          listEl.innerHTML = "<div class='no-data'>لا توجد بيانات</div>";
          return;
        }

        const nameCol = Object.keys(rows[0]).find(k => k.includes("اسم"));
        const specCol = Object.keys(rows[0]).find(k => k.includes("تخصص"));
        const phoneCol = Object.keys(rows[0]).find(k => k.includes("هاتف") || k.includes("phone"));

        document.getElementById('count').textContent = rows.length;
        const specialties = new Set(rows.map(r => r[specCol] || "").filter(Boolean));
        document.getElementById('specialties').textContent = specialties.size;

        // أول 10 في الإعلان
        const top10 = rows.slice(0, 10).map(r => `${r[nameCol] || "بدون اسم"} - ${r[specCol] || "غير محدد"}`);
        if (top10.length > 0) {
          adText.textContent = top10.join(" | ");
          adEl.style.display = "flex";
        }

        // باقي البيانات
        const rest = rows.slice(10);
        listEl.innerHTML = "";
        rest.forEach(r => {
          listEl.innerHTML += `
            <div class="card">
              <div class="name">${r[nameCol] || "<span class='no-data'>بدون اسم</span>"}</div>
              <div class="meta">${r[specCol] || "<span class='no-data'>غير محدد</span>"}</div>
              <div class="phone">${r[phoneCol] ? `<a href="tel:${r[phoneCol]}" style="color:#fff">${r[phoneCol]}</a>` : "<span class='no-data'>غير متوفر</span>"}</div>
            </div>
          `;
        });
      } catch (e) {
        console.error(e);
        listEl.innerHTML = "<div class='no-data'>خطأ في تحميل البيانات</div>";
      }
    }

    loadData();
  </script>
</body>
</html>